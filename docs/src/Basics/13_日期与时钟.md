# ğŸŒŒ Cesium ä¸­çš„ JulianDateï¼ˆå„’ç•¥æ—¥æœŸï¼‰è¯¦è§£

## ä»€ä¹ˆæ˜¯å„’ç•¥æ—¥æœŸï¼Ÿ

JulianDateï¼ˆå„’ç•¥æ—¥æœŸï¼‰ æ˜¯å¤©æ–‡å­¦å’Œèˆªå¤©é¢†åŸŸä¸­å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§è¿ç»­æ—¶é—´è¡¨ç¤ºæ³•ã€‚å®ƒè¡¨ç¤ºä»å…¬å…ƒå‰ 4713 å¹´ 1 æœˆ 1 æ—¥ä¸­åˆ 12 æ—¶ï¼ˆä¸–ç•Œæ—¶ï¼‰å¼€å§‹è¿ç»­è®¡ç®—çš„å¤©æ•°ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦ JulianDateï¼Ÿ

1. æ—¶é—´è¿ç»­æ€§ï¼šæ²¡æœ‰æ—¥æœŸä¸­æ–­ï¼ˆå¦‚é—°å¹´ã€é—°ç§’é—®é¢˜ï¼‰

2. é«˜ç²¾åº¦è®¡ç®—ï¼šæ”¯æŒæ¯«ç§’çº§ç”šè‡³å¾®ç§’çº§æ—¶é—´ç²¾åº¦

3. è·¨å¹³å°å…¼å®¹ï¼šé¿å…æ—¶åŒºå’Œæ—¥å†ç³»ç»Ÿçš„å·®å¼‚

4. ç§‘å­¦è®¡ç®—æ ‡å‡†ï¼šèˆªå¤©ã€å¤©æ–‡é¢†åŸŸçš„é€šç”¨æ—¶é—´è¡¨ç¤º

## JulianDate çš„ç»“æ„

```js
{
  day: 2460830,      // æ•´æ•°éƒ¨åˆ† - ä»å„’ç•¥æ—¥èµ·å§‹æ—¥ç®—èµ·çš„å¤©æ•°
  secondsOfDay: 43200 // å°æ•°éƒ¨åˆ† - å½“å¤©å·²è¿‡å»çš„ç§’æ•°ï¼ˆ0-86400ï¼‰
}
```

## JulianDate ä¸å¸¸è§„æ—¥æœŸçš„è½¬æ¢

### JulianDate ä¸åŒ—äº¬æ—¶é—´

JulianDate æ¯”åŒ—äº¬æ—¶é—´æ™š 8 ä¸ªå°æ—¶, åŠ ä¸Šä¸œ 8 æ—¶ï¼Œå°±æ˜¯å½“å‰çš„çœŸæ­£æ—¶é—´

```js
// åˆ›å»ºå½“å‰æ—¶é—´å¯¹åº”çš„ JulianDate
const julianDate = Cesium.JulianDate.fromDate(new Date());
// å°† JulianDate è½¬æ¢ä¸ºåŒ—äº¬æ—¶é—´
const beijingDate = Cesium.JulianDate.addHours(
  julianDate,
  8,
  new Cesium.JulianDate()
);
```

### å¸¸è§„æ—¥æœŸ â†’ JulianDate

#### ä»å½“å‰æ—¶é—´åˆ›å»º

```js
// åˆ›å»ºå½“å‰æ—¶é—´çš„JulianDateï¼ˆæ¨èï¼‰
const nowJulian = Cesium.JulianDate.now();

// ä»JavaScript Dateåˆ›å»º
const jsDate = new Date();
const fromJsDate = Cesium.JulianDate.fromDate(jsDate);
```

#### ä» ISO 8601 å­—ç¬¦ä¸²åˆ›å»º

```js
// ä»ISO 8601å­—ç¬¦ä¸²åˆ›å»ºï¼ˆUTCæ—¶é—´ï¼‰
const isoString = "2025-06-04T12:00:00Z"; // Zè¡¨ç¤ºUTCæ—¶é—´
const fromIso = Cesium.JulianDate.fromIso8601(isoString);

// å¸¦æ—¶åŒºçš„ISOå­—ç¬¦ä¸²ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ä¸ºUTCï¼‰
const localIsoString = "2025-06-04T20:00:00+08:00"; // åŒ—äº¬æ—¶é—´
const fromLocalIso = Cesium.JulianDate.fromIso8601(localIsoString);
```

### JulianDate â†’ å¸¸è§„æ—¥æœŸ

#### è½¬æ¢ä¸º JavaScript Date

```js
const julianDate = Cesium.JulianDate.now();

// è½¬æ¢ä¸ºJavaScript Dateï¼ˆä¼šä¸¢å¤±çº³ç§’ç²¾åº¦ï¼‰
const jsDate = Cesium.JulianDate.toDate(julianDate);
```

#### æ ¼å¼åŒ–ä¸º ISO 8601 å­—ç¬¦ä¸²

```js
const julianDate = Cesium.JulianDate.now();

// æ ¼å¼åŒ–ä¸ºISO 8601å­—ç¬¦ä¸²ï¼ˆUTCï¼‰
const isoString = Cesium.JulianDate.toIso8601(julianDate);
// è¾“å‡º: "2025-06-04T12:00:00.000Z"

// å¸¦æ¯«ç§’ç²¾åº¦
const isoWithMs = Cesium.JulianDate.toIso8601(julianDate, 3);
// è¾“å‡º: "2025-06-04T12:00:00.500Z"ï¼ˆå‡è®¾500msï¼‰
```

## æ—¶é—´æ“ä½œå®ç”¨å‡½æ•°

### æ—¶é—´åŠ å‡

- `addDays`ï¼šå¢åŠ å¤©æ•°
- `addHours`ï¼šå¢åŠ å°æ—¶æ•°
- `addMinutes`ï¼šå¢åŠ åˆ†é’Ÿæ•°
- `addSeconds`ï¼šå¢åŠ ç§’æ•°

#### å¢åŠ æ—¶é—´

```js
const baseDate = Cesium.JulianDate.fromIso8601("2025-06-04T12:00:00Z");
const result = new Cesium.JulianDate();

// å¢åŠ 1å¤©3å°æ—¶30åˆ†é’Ÿ
const newDate = Cesium.JulianDate.addDays(baseDate, 1, result);
Cesium.JulianDate.addHours(newDate, 3, result);
Cesium.JulianDate.addMinutes(result, 30, result);

console.log(Cesium.JulianDate.toIso8601(result));
// è¾“å‡º: "2025-06-05T15:30:00Z"
```

#### å‡å°‘æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿæ•°ï¼‰

```js
const baseDate = Cesium.JulianDate.fromIso8601("2025-06-04T12:00:00Z");
const result = new Cesium.JulianDate();

// å‡å°‘2å°æ—¶
Cesium.JulianDate.addHours(baseDate, -2, result);
console.log(Cesium.JulianDate.toIso8601(result));
// è¾“å‡º: "2025-06-04T10:00:00Z"
```

## Cesium ä¸­çš„æ—¶é’Ÿ Clock

`Clock` æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºæ§åˆ¶åœºæ™¯çš„æ—¶é—´åŠ¨æ€ï¼Œç®¡ç†æ—¶é—´æµé€ã€åŠ¨ç”»æ’­æ”¾ã€æ—¶é—´èŒƒå›´ç­‰

### å±æ€§

| å±æ€§            | ç±»å‹       | è¯´æ˜                                                                            |
| --------------- | ---------- | ------------------------------------------------------------------------------- |
| `currentTime`   | JulianDate | å½“å‰åœºæ™¯æ—¶é—´ï¼ˆå¯è¯»å†™ï¼‰                                                          |
| `startTime`     | JulianDate | æ—¶é—´è½´èµ·å§‹æ—¶é—´                                                                  |
| `stopTime`      | JulianDate | æ—¶é—´è½´ç»“æŸæ—¶é—´                                                                  |
| `multiplier`    | Number     | æ—¶é—´æµé€å€ç‡ï¼ˆæ­£=æ­£å‘æ’­æ”¾ï¼Œè´Ÿ=å€’æ”¾ï¼‰                                            |
| `clockStep`     | ClockStep  | åˆ¤æ–­å¯¹ Clock#tick çš„è°ƒç”¨æ˜¯å¦ä¾èµ–äºå¸§æˆ–ç³»ç»Ÿæ—¶é’Ÿã€‚                                |
| `clockRange`    | ClockRange | åˆ°è¾¾æ—¶é—´è¾¹ç•Œçš„è¡Œä¸ºï¼šUNBOUNDEDï¼šä¸åœæ­¢ï¼ŒCLAMPEDï¼šåœæ­¢åœ¨è¾¹ç•Œï¼ŒLOOP_STOPï¼šå¾ªç¯æ’­æ”¾ |
| `shouldAnimate` | Boolean    | æ˜¯å¦è‡ªåŠ¨æ’­æ”¾ï¼ˆtrue=æ’­æ”¾ï¼Œfalse=æš‚åœï¼‰                                           |

#### ClockStep è¯¦è§£

ClockStep å†³å®šæ—¶é—´å¦‚ä½•å‰è¿›ï¼š

| ClockStep å€¼              | è¯´æ˜             | é€‚ç”¨åœºæ™¯      |
| ------------------------- | ---------------- | ------------- |
| `SYSTEM_CLOCK`            | ä¸ç³»ç»Ÿæ—¶é—´åŒæ­¥   | å®æ—¶æ¨¡æ‹Ÿ      |
| `SYSTEM_CLOCK_MULTIPLIER` | ç³»ç»Ÿæ—¶é—´ Ã— å€ç‡  | åŠ é€Ÿ/å‡é€Ÿæ¨¡æ‹Ÿ |
| `TICK_DEPENDENT`          | æ¯å¸§å‰è¿›å›ºå®šæ—¶é—´ | ç²¾ç¡®æ§åˆ¶åŠ¨ç”»  |

#### ClockRange è¯¦è§£

ClockRange æ§åˆ¶åˆ°è¾¾è¾¹ç•Œæ—¶çš„è¡Œä¸ºï¼š

| ClockRange å€¼ | è¯´æ˜             | é€‚ç”¨åœºæ™¯     |
| ------------- | ---------------- | ------------ |
| `UNBOUNDED`   | ä¸å—é™åˆ¶ç»§ç»­å‰è¿› | æ— è¾¹ç•Œæ—¶é—´   |
| `CLAMPED`     | åœåœ¨è¾¹ç•Œ         | å›ºå®šåŒºé—´åŠ¨ç”» |
| `LOOP_STOP`   | å¾ªç¯æ’­æ”¾         | é‡å¤åŠ¨ç”»     |

#### åŸºç¡€é…ç½®

```js
const clock = new Cesium.Clock({
  startTime: Cesium.JulianDate.fromIso8601("2023-01-01T00:00:00Z"),
  currentTime: Cesium.JulianDate.fromIso8601("2023-01-01T12:00:00Z"),
  stopTime: Cesium.JulianDate.fromIso8601("2023-01-02T00:00:00Z"),
  clockRange: Cesium.ClockRange.LOOP_STOP, // å¾ªç¯æ’­æ”¾
  multiplier: 2.0, // 2å€é€Ÿæ’­æ”¾
  clockStep: Cesium.ClockStep.SYSTEM_CLOCK,
});

// åœ¨ Viewer ä¸­ä½¿ç”¨
const viewer = new Cesium.Viewer("cesiumContainer", {
  clock: clock,
  shouldAnimate: true, // æ’­æ”¾
});
```

#### åŠ¨æ€æ§åˆ¶

```js
// æ’­æ”¾/æš‚åœ
viewer.clock.shouldAnimate = !viewer.clock.shouldAnimate;

// è°ƒæ•´æ’­æ”¾é€Ÿåº¦
viewer.clock.multiplier = 4.0; // 4å€é€Ÿ

// å€’æ”¾
viewer.clock.multiplier = -1.0; // å€’æ”¾

// è·³è½¬åˆ°ç‰¹å®šæ—¶é—´
const targetTime = Cesium.JulianDate.fromIso8601("2025-06-04T18:00:00Z");
Cesium.JulianDate.clone(targetTime, viewer.clock.currentTime);

// é‡ç½®æ—¶é’Ÿ
viewer.clock.currentTime = Cesium.JulianDate.clone(viewer.clock.startTime);
```
