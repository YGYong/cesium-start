# 事件学习

Cesium 的事件系统允许开发者监听和响应场景中的各类交互与状态变化，涵盖 相机操作、实体交互、屏幕输入 等核心场景

## 屏幕空间事件

屏幕空间事件是最常用的事件类型，用于处理用户在屏幕上的交互操作，如鼠标点击、移动、悬停等,使用
`new Cesium.ScreenSpaceEventHandler(element)`,[ScreenSpaceEventHandler 传送门](https://cesium.com/learn/cesiumjs/ref-doc/ScreenSpaceEventHandler.html?classFilter=ScreenSpaceEventHandler)

### 鼠标交互事件

使用`setInputAction`监听鼠标点击、移动、悬停等行为

- setInputAction(action, type, modifier)
  - action: 回调函数, 事件触发后执行的操作
  - type: 事件类型, 如鼠标左键点击, 鼠标移动等
  - modifier: 键盘事件修饰符, 如 shift, ctrl, alt 等

| 名字              | 类型   | 描述                           |
| ----------------- | ------ | ------------------------------ |
| LEFT_DOWN         | number | 表示鼠标左键按下事件。         |
| LEFT_UP           | number | 表示鼠标左键松开事件。         |
| LEFT_CLICK        | number | 表示鼠标左键单击事件。         |
| LEFT_DOUBLE_CLICK | number | 表示鼠标左键双击事件。         |
| RIGHT_DOWN        | number | 表示鼠标右键按下事件。         |
| RIGHT_UP          | number | 表示鼠标右键松开事件。         |
| RIGHT_CLICK       | number | 表示鼠标右键单击事件。         |
| MIDDLE_DOWN       | number | 表示鼠标中键按下事件。         |
| MIDDLE_UP         | number | 表示鼠标中键松开事件。         |
| MIDDLE_CLICK      | number | 表示鼠标中键单击事件。         |
| MOUSE_MOVE        | number | 表示鼠标移动事件。             |
| WHEEL             | number | 表示鼠标滚轮事件。             |
| PINCH_START       | number | 表示触摸表面上双指事件的开始。 |
| PINCH_END         | number | 表示触摸表面上双指事件的结束。 |
| PINCH_MOVE        | number | 表示触摸表面上双指事件的更改。 |

举一个鼠标左键点击获取经纬度的案例:

```js
// 添加地图点击事件, 点击后获取点击位置的经纬度
viewer.screenSpaceEventHandler.setInputAction(function (e) {
  // 点击后获取点击位置的笛卡尔坐标
  const cartesian = viewer.scene.pickPosition(e.position);
  // 笛卡尔坐标转弧度坐标
  var cartographic = Cesium.Cartographic.fromCartesian(cartesian);
  // 弧度转度数
  var longitudeString = Cesium.Math.toDegrees(cartographic.longitude);
  var latitudeString = Cesium.Math.toDegrees(cartographic.latitude);
  var heightString = cartographic.height;
  console.log(
    "Longitude: " +
      longitudeString +
      ", Latitude: " +
      latitudeString +
      ", Height: " +
      heightString
  );
}, Cesium.ScreenSpaceEventType.LEFT_CLICK);
```

销毁事件:

```js
viewer.screenSpaceEventHandler.removeInputAction(
  Cesium.ScreenSpaceEventType.LEFT_CLICK
);
```

- 如何判断点击到了实体和获取实体的信息,实体的属性可参考[实体](./08_实体.md)

1. 添加实体,并定位到实体

```js
// 添加实体
const circle = viewer.entities.add({
  id: "circle",
  name: "circle",
  description: "This is circle",
  position: Cesium.Cartesian3.fromDegrees(-75.59777, 40.03883),
  ellipse: {
    semiMajorAxis: 1000,
    semiMinorAxis: 1000,
    material: Cesium.Color.RED.withAlpha(0.5),
    outline: true,
    outlineColor: Cesium.Color.WHITE,
  },
});
// 定位到实体
viewer.zoomTo(circle);
```

2. 添加鼠标点击事件,判断点击到了实体,并获取实体的信息

```js
const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
handler.setInputAction(function (e) {
  // 使用scene.pick方法获取点击位置的实体
  const pickedObject = viewer.scene.pick(e.position);
  if (
    Cesium.defined(pickedObject) &&
    pickedObject.id instanceof Cesium.Entity
  ) {
    const entity = pickedObject.id;
    console.log("实体信息:", entity); // 输出实体信息
  } else {
    console.log("未点击到实体");
  }
}, Cesium.ScreenSpaceEventType.LEFT_CLICK);
```

### 键盘事件

- **键盘修饰符不可以单独使用，需要配合鼠标输入事件使用**

- 如需监听单个键盘事件,可使用原生的`document.addEventListener("keydown", function (event) {});`,[参考相机自由移动案例](http://localhost:5173/Basics/05_%E7%9B%B8%E6%9C%BA.html#%E7%9B%B8%E6%9C%BA%E8%87%AA%E7%94%B1%E7%A7%BB%E5%8A%A8-%E5%8F%AF%E9%80%9A%E8%BF%87%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6%E7%9B%B8%E6%9C%BA)

| 名字  | 描述                |
| ----- | ------------------- |
| SHIFT | 表示 shift 键被按住 |
| CTRL  | 表示 ctrl 键被按住  |
| ALT   | 表示 alt 键被按住   |

```js
viewer.screenSpaceEventHandler.setInputAction(
  function (e) {
    console.log("同时按住Shift + 鼠标左键");
  },
  Cesium.ScreenSpaceEventType.LEFT_CLICK,
  Cesium.KeyboardEventModifier.SHIFT
);
```

## 相机事件

| 名字      | 描述                                         |
| --------- | -------------------------------------------- |
| moveStart | 获取将在摄像机开始移动时引发的事件           |
| moveEnd   | 获取当摄像机停止移动时将引发的事件           |
| changed   | 获取当摄像机位置或方向发生变化时将引发的事件 |

```js
// 监听相机移动开始
viewer.camera.moveStart.addEventListener(() => {
  console.log("相机开始移动");
});

// 监听相机移动结束
viewer.camera.moveEnd.addEventListener(() => {
  console.log("相机移动结束");
});

// 监听相机位置或方向发生变化
viewer.camera.changed.addEventListener(() => {
  console.log("相机位置或方向发生变化");
});
```
